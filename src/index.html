<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="style.css"/>
        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
        <title>Weather Where You Are</title>
    </head>
    <body>
    <div id="the_whole_thing">
        <header>
        <h1>Today's Weather</h1>
        </header>
        <div id="middle">
            <h2> Weather for {{show_location}}</h2>
            <div v-for="(day, index) in magic_list" class="weather">
            <div class="day" v-on:click="vote" v-bind:data-index="index">
            <ul>{{index}}
                <li >
                    {{Date(day.dt_text)}}
                </li>
                <li>
                    {{"Temperature " + day.main.temp + "*F"}}
                </li>
                <li>
                    {{day.weather[0].description}}
                </li>
                <li>
                    {{"Humidity " + day.main.humidity + "%"}}
                </li>
                <li>
                    {{"Pressure " + day.main.pressure + "hPa"}}
                </li>
            </ul>
            </div>
            </div>
        </div>
    </div>
    
    <script>
    var app = new Vue ({
        el: '#middle',
        data: {
            apilayer_key: "e930d5648454273dc89327a525966b27",
            owm_key: "fd8389fcd4b723879831f6cb0f09c2b2",
            location: "Location String",
            magic_list: [],
            date: 1555459200,
        },
        methods: {
            vote: function(ev) {
                let index = ev.target.getAttribute('data-index');
                this.magic_list[index].setAttribute(style) = "background-color: black;"
            }
        },
        computed: {
            show_location: function() {
                return this.location;
            },
        },
        //Do this when the page loads
        created() {
            fetch(`http://api.ipstack.com/144.39.244.36?access_key=${this.apilayer_key}`)
                .then(response => response.json())
                .then(json => {
                    //this.location = json[0]
                    var city = json.city;
                    var zip = json.zip;
                    var region = json.region_name;
                    this.location = city + ", " + region + " " + zip;
                    return fetch(`http://api.openweathermap.org/data/2.5/forecast?zip=${zip}&APPID=${this.owm_key}&units=imperial`)})
                .then(response => response.json())
                .then(json => {
                    this.obj = json;
                    this.magic_list = json.list;
                    console.log(this.magic_list);
                });
        },
    });
    </script>
    </body>
    
    
</html>
